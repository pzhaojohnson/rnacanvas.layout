/**
 * @jest-environment jsdom
 */

import { untangle } from './untangle';

import { NucleobaseMock } from './NucleobaseMock';

import { isFiniteNumber } from '@rnacanvas/value-check';

import { shuffled } from '@rnacanvas/utilities';

import * as fs from 'fs';

class StructureMock {
  static fromDotBracket(dotBracket) {
    expect(dotBracket.split('').every(c => ['.', '(', ')'].includes(c))).toBeTruthy();

    let seq = dotBracket.split('').map(() => new NucleobaseMock({ centerPoint: { x: 0, y: 0 } }));

    let basePairs = [];

    let unmatchedStack = [];

    dotBracket.split('').forEach((c, i) => {
      if (c == '(') {
        unmatchedStack.push(i);
      } else if (c == ')' && unmatchedStack.length == 0) {
        throw new Error('Unmatched closing bracket in dot-bracket notation.');
      } else if (c == ')') {
        let j = unmatchedStack.pop();
        basePairs.push([seq[j], seq[i]]);
      } else if (c != '.') {
        throw new Error(`Unrecognized character in dot-bracket notation: "${c}".`);
      }
    });

    if (unmatchedStack.length > 0) {
      throw new Error('Unmatched opening bracket in dot-bracket notation.');
    }

    return [seq, basePairs];
  }
}

class Layout {
  constructor(targetBases) {
    this.targetBases = targetBases;
  }

  isValid() {
    return this.targetBases.every(b => {
      let centerPoint = b.getCenterPoint();

      return [centerPoint.x, centerPoint.y].every(isFiniteNumber);
    });
  }
}

/**
 * Random structures in dot-bracket notation.
 */
const randomStructures = [
  '...(((.....)))...',
  '.(((((....((((.((((((((((((......((((((.......)))))).......))))..((((.(((.(((.((((((....)))))).))).)))..))))(((((((((((((((((((((..(((..((((((((..(((.(((((((((......))).))))))(((((((((((.....((.(((((((...)))))))((((...)))).........)).....)))))))))))..)))..))))))))..)))...))))))).))))))((((((.(((.(((((((((...((.((((((((((((((....)))))))).))))))))...))))).)))).)))))))))((((((((....((((((((((((.(((((....)))))))))).)))))))...))))))))))))))))....))))))))))))(((.(((((..(((.(((...((((........)))).))).)))))))).)))....)))))((((....((((..((((....(((((((..(((.(((((((........))))..)))..))))))).)))))))..))))....))))',
  '....(((....(((.......)))...))).....',
  '..........(((((((((((..((.((.((.(((((((.((((....(((((......)))))...)))).))))))).)).)).)).)))))))))))(((((.((.(((((..(((((....)))))(((((.........((((((....((((....))))..))))))........)))))..(((((...(((((..........(((((..(((((((.(((((((((((((((...)))))..)))).((((.(((.((((.....))))))).))))..)))))))))))))..)))))....(((((((.((((......((((..((((((((....)))))))).....))))))))..)))).)))))))).)))))((((..((((((((((((((((.(((((((((((...(((((.(((((.....))))).)))))...)))).))))))).)))))))))).))))))..)))).....(((((((.((((.......)))))))))))((((((((((((((...(((((.((...)).))))).....)))))..))..))).))))...(((....((((.((((((((.(((....((((......))))....(((((((((((((((..((((((((((.(((....)))((((((....((((...(((........))))))).....(((((((((((..((((((((((....(((((...)))))..)))).(((((........))))).....)))))).)))))))))))(((((((.((.(((.(((.....(((((.....)))))....))).))))))))))))..((((.((......)).)))).....((((.((((.....(((((.....)))))....((((((...(((((((..((((..(((((((((((((.......(((((((.....(((((((...)))))))..))))))).((((((((...((...))...))))))))....)))))).((((((..(((((((((((....(((.(((((...((((.(((((..((.((.(((((...((((((((((((.....(((((((((((.(((((((....))))))).)))))))))))......)))..)))))))))....))))).)).)).)))))))))....))))))))....))))))))))).))))))..)))))))..)))).)))))))...))))))....)))))))).....(((...)))..))))))....))))))))))....)))))))))))))))))).))))..))))...))))....)))..))))))).)))))....',
  '...((((((..((((.............)))).....))))))..(((((((((...(((.(((((..((((((.((.....(((((...)))))..)).)))))).)))))..)))(((((((....((.((((((..((((..........((((.((((((..............))))))...))))..(((......)))..........))))..))))))))....((....((...(((((.((.....))....)))))...)).....))...)))))))(((((.((......)).)))))....)))))).)))(((..((((((((((....(((((..((.((((....((((....))))..))))))..)))))((((((((.......))))))))................(((((.((.(((.........))).))))))).((.(((((......)))))))..(((.....)))(((((((.((((((...)))))).....)))))))..(((.(((((.....((((((..(((.((((((((((...)))...))))))).)))..))))))(((.((.......)).))).((((((..............(((((((((..(((((((((..((.((.(((.(((......((((....))))...)))..))).)).))..(((((((((((((((((.(((..((((.((((......)))).)))).))).............((((..(((((((.((((....(((...)))...)))).)))))))))))...))))))).((((((((.......))))..))))..((.(((((((((((....((((..........((((.....)))).......(((((((((.(((....)))..))))))))).........(((((....)))))..(((((((...((((((..((((...........))))...(((...(((((((..((.((((((......))))))...))...)))).)))..)))..))))))...(((((((((.(((.(((((((.............(((((....(((....)))....)))))...(((((..((....)))))))))))))).)))))))((((.(((((.((((....(((((....)))))....)))).)))))))))...))))))))))))....))))....))).)))))))).))((.(((((....)))))))...)))))))))).....((((((((..(((((((((((((((.(((.(((...........(((((((............)))))))........((....))...)))))).))))).............((((((((((((((...)).)))))))...)))))....((((((...(((..((((((((((.(((.......))).))))..((((((......))))))((((..(((((....(((......)))...)))))..))))...)))))))))..)))))).....((((...)))).(((((((((..((..(((((((.((((((((((((.................)))..)))).)))))..))..)))))...))..))))..)))))...))))).)))))..)))....))))).((.((((....)))).))................((((((((.(((((((((.........................)))......))))))..))))))))...((((.(((....)))))))))))).))))..)))))).)))..(((...(((...(((((((((.......)))))))))..)))))).))))))............((((((((((((((............)))..))))))))))).((((((.((((((..(((..((((((((......))))).........((((((.(((........))))))))).........))).)))))))))..)))))).......((((((((((.((((((..((((.((.((((((((.........(((((((........))))))))))))))).))..))))...))))))........((((((((((...(((((..((.((.((((((...)))))))).))..)))))...)))............)))))))......))))))))))......))))).))).))))))))))..)))',
  '...((((((..((((.............)))).....))))))..((((((((((..(((.(((((..((((((.((.....(((((...)))))..)).)))))).)))))..)))..)........((.((((((..((((..........((((.((((((..............))))))...))))..(((......)))..........))))..))))))))........((((..............))))...........((((((......))))))..(((((............)))))....)))))).)))(((..((((((((((.....((((..(..((((....((((....))))..)))).)..)))).((((((((.......))))))))................(((((.((.(((.........))).))))))).((.(((((......))))))).............(((((((.((((((...)))))).....)))))))..(((.(((((.....((((((..(((.(((((((............))))))).)))..))))))(((.............))).....................(((((((((..(((((((((..((.((.(((..............................))).)).))..(((((((((((((((((.((...((((.((((......)))).))))..)).............((((..(((((((.((((....(((...)))...)))).)))))))))))...))))))).((((((((.......))))..))))..((.(((((((((((....((((..........((((.....)))).......(((((((((.((......))..)))))))))..........((((....))))...(((((((...((((((..((((...........))))...(((...(((((((..((.((((((......))))))...))...)))).)))..)))..))))))...((((((((..(((.(((((((.............(((((....(((....)))....)))))...(((((...(....).)))))))))))).))).)))((((.(((((.((((....(((((....)))))....)))).)))))))))...))))))))))))....))))....))).)))))))).))((.(((((....)))))))...)))))))))).....((((((((..(((((((((.(((((.(((.((((..........(((((((............)))))))........((....)).).)))))).))))).............(((((((((((((.....).)))))))...)))))....((((((.((......(((((((((.(((.......))).))))....((((......))))..((((..(((((....(((......)))...)))))..))))...))))).))...)))))).....((((...))))..((((.(((..............((((((((((((.................)))..)))).)))))..................)))...)))).....)))).)))))..)))....)))))...................................((((((((.(((((((((.........................)))......))))))..))))))))...((((.(((....)))))))))))).))))..)))))).)))........(((...(((((((((.......)))))))))..)))......................((((((((((((((............)))..)))))))))))........((((((..(((..((((((((......))))).........(((((.((((........))))))))).........))).)))))))))...............(((((((((...(((((..((((.((.((((((((.........(((((((........))))))))))))))).))..))))...))))).........((((((((((...(((((..((.((.((((((...)))))))).))..)))))...)))............))))))).......)))))))))......))))).))).))))))))))..)))',
  '..........((((((((((((.......(((((((((...............)))))))))....((((..((((............))))..)))).......))))))...)).))))',
  '(((((...(((..(((((.........(((.((((((......)))))).(((((.(((......))).))))).....))).........)))))..))).....(((((((((............)))))))))........(((.......)))..((((((((......((....))))))))))((((((.((((((((((((....(((((((...((((...(((....(((((((((....)))))))))..)))....((.((((((...))))))))..)))).)))))))......((((.....))))(((.....)))((((((((((((((((((.......)))))))..((((.((((...((.((((....)))))))))).)))).....((((.((((.....))))..))))(((((.....)))))....(((((.((((.................))))))))).....(((((((((.((......)).)))))))))....((((((((....((.(((.((((.....)))).))).)).....))))))))....))).))))))))(((............)))(((((((((((((((.(((((...(((((((....))))))).....((((((...((((((((((((((((..(((..(((.((((.((.((((....))))...))(((.(((((....))))).))))))).)))..)))..))))))(((.(((((((((......(((((..((.(((............)))))..))))))))))).)))...)))......)))))...))).)).....)))))).(((((..(((((.....)))))..)))))((((....)))).....(((((((..........((((((....(((..((....))..)))..(((......))).((((((....(((((....((.....))....)))))...))))))..)))))).........)))))))))))).....)))))))))).))))).))))......)))))))).......(((((.((((..((((.((((......))))))))...))))...))))).......(((((((((.........)))))))))........)))))).....)))))...',
  '.(((.((.((((((.(((((((..........(((....)))...(((((.(((...((((((..(((((((.....(((((((.((..........))......((((((((((((((((....)))))))).......(((((.((((.(((.((((..((((((((((.((((((....)))))).....))))))...))))..)))))))..)))).)))))....))))))))...))))))).......))))))).........))))))...(((((((.((.......((.........)).......)).))))))).....((((((((((...((.(((((((((....((((.......))))....(((..((((((......))))))..)))..........((((((.(((((((...(((((.((((...))))..)))))...)).)))))(((.((((((((((((...(((((..(((((((.....((((((....(((..((......))..)))))))))..))))))))))))...))))))))))))))).......((((((((((....((((((..((...((((.....))))...))..))))))....))))))))))..((((((.......((((((((((((....(((.(((((..((((((....(((..(((.((....)).))).)))....)))))).)))))...))).(((((((((((((....(((((.....((((.....))))...)))))........((..(((.(((......))))))..))))))).))))).))).....(((((((.....))))))))))))))))..((((.((((.(((((....)))))..))))))))))).......))))))....(((((.......)))))...))))))(((((.(((((.((.(((((((.((((..((((.((((((.((......)).))))))..)))).......((((((...((((((.(((.((......)).)))............(((((.((((......)))))))))((.....))(((((((.(((...)))))))))).....)))))).)))))).........((((((((...)))..)))))..(((((((...((.....))...)))))))..)))).))))))).)))))))...))))).))))))))).)).((((.(((......((((..(((..(((((....((((........)))))))))..)))..))))..))).))))...))))))))))(((((((((.............(((((....))))).(((((((.((((((..((((..((((.(((((.......)))))....((((((((..(((((...............)))))......((.((((....((((..(((((...((((..(((.((....((((...(((....((.........(((((...........(((((((..((((..(((.........)))..))))....)))))))............)))))(((((....))))).....))....)))...))))....(((..........))))).)))..))))..)).)))..)))).....(((((((.((...(((......)))....(((((...)))))....(((((((((((((.......)))))))).)))))......((((((...((((((............))))))..))))))..)).)))))))((((....))))...)))).))...........((((((((((...(((((.((((..(((((.....((.....))))))).)))).)))))...........)))))))))).(((.........)))..((((((((((((.......)))).)))))))).))))...)))).......))))..))))..)))))).)))))))((((.........((..((.((((..((((.((((.(((..((.(((((.(((.....)))))))).)).))).))))))))..)))).))..))..........((((.....)))).((((((...((((((..((((((((...((((....)))).....((..(((.(((((.((.....(((((((((((((.........))).......((((((.....((((....))))..))))))..))))))))))..((((((.(((....)))))))))..........)).))))))))..))(((((((((.((((.......((((((((..(((((.....))))).)).))))))...))))..)))))))))))))))))..))))))))))))))))...)).))))))).))).)))))..))))))).)))).....)).)).)))....',
  '.((..((.((((((.(((((((..........(((....)))...(((((.((....((((((...(((((..................................((((((((((((((((....)))))))).......(((((.((((.(((.((((..((((((((((.((((((....)))))).....))))))...))))..)))))))..)))).)))))....))))))))..................)))))..........))))))...(((((((.((...........................)).)))))))......................................................((..((((((......))))))..))............................(((((.((((...))))..)))))............((.((((((((((((...(((((..(((((((..(((..((.....))..)))......................))))))))))))...)))))))))))))).........((((.(((.....(((((.............................))))).....))).))))....................((((((....................((((((..........(......).....................))))))................................................................((..(((......))).))........................(((((((.....)))))))..)))))).............(((((....)))))..(((((......)))))............(((((.......))))).....................((..((((((.(((...((((.((((((.((......)).))))))..)))).......((((((...((((((.(((.((......)).)))............(((((.((((......)))))))))((.....))(((((((.(((...)))))))))).....)))))).)))))).........((((((((...)))..)))))..(((((((...((.....))...)))))))...))).))))))..))...........................((((..((......((((..(((..(((((....((((........)))))))))..)))..))))..))..))))...................................(((((....)))))..((((((.((((((...................................................................((((((..((....((..((((........((.......(((.((..(..((....))..)..)).)))......................((((((..((((..(((.........)))..))))....)))))).................((((((....))))))........................................))......))))..))..))..))))))................((........))....(((((...)))))....((((.((((((((.......))))))))..))))...............((((((............)))))).(((((.....((((.(((..................................((((((((((....(((..((((..(((((.....(.......)))))).))))..)))............)))))))))).(((.........)))..((((((((((((.......)))).))))))))......)))..)))).)))))..........)))))).))))))............(((((....((((..((((.((((.(((..((.(((((.(((.....)))))))).)).))).))))))))..))))...(((((.........((((.....))))......(((........)))........))))).....)))))........................(((((((((.(((.........))).......((((((.....((((....))))..))))))...)))))))))..((((((...........))))))..........................................................(((.....))).......................................................................)).)))))..))))))).)))).....)).))..))....',
  '.((((.(((.....(((.(((.((((((((((((((.((((((((......))).....(((((((((((((((((((((((........(((((((...(((((..(((((((((.......((((((...(((((....(((............))).....)))))..(((....))).)))))).))))))))))))))...)))..)))).......)))))).)))))))..)))))((((((((((((....(((((((((((((((.....))))).(((.((........)))))))))))))))....))))))).((((....)))).....)))))((((..((((((((((((......)).))))...))))))..))))(((.......))).(((((((((...............(((((((((......((((.((((.....)))))).)).)))))))))(((((...))))).......)))))))))..)))))......((((((((((...((((((.(((((((((..((.(((((..((.......))..))))).)).........)))))(((.(((((.((...(((..(((........))))))))))))).)))))))..(((((.....))))).))))))........))).))))))).))))).))))....)))))))))).)))..(((((((((((.(((((((......((((((............((((.((((.((((((...........)))).)).)))).)))).....((((((((...)))))).))))).)))..)))).)))..)))))....)))))).))).....))))))).(((...(((.....)))..)))..',
  '.((((.(((.....(((.(((.((((((((((((((.(((((((((...(((((((((((((..((((((((((((((((((.............((...(((((..(((((((((.......((((((...(((((........(..(((...))).).....)))))..(((....))).)))))).))))))))))))))...))..............)))))).)))))))..)))))................(((((((((((((((.....))))).(((.((.(.....))))))))))))))))........................................((((((((((((......))).)))...))))))..(((((((((......................((.((((....((....)).....((((((((..................(((........................................((((..............................)))).....((((..((.......))..)))).................)))..............)))).)))).)))).))............)))))))))(((((.....)))))..))))))).))))..)).))))....))))).))))....)))))))))).)))..(((((((((((.((.(((.........................((((.((((.((((((...........)))).)).)))).)))).....((((((((...)))))).))..........)))..))..)))))....)))))).))).....)))))))..((...(((.....)))..))...',
  '((.(((((......(((((..........((.(((((((........((((((..........)))))).(((.(((.((((((..........))))))))).)))...((((((((.....((((......)))))))))))).........(((((((....)))))))(((((((((((.........))))).))))))....((((((.....((((.....))))))))))...(((....((((((((...))))).)))....))).(((((......)))))..)))))))))..((((((((((((...))))...(((.(((....))).)))((((((((........))))))))..(((((((((((.............)).))))))))).((((((.((..((((((((((.....................)))))).)))).))..(((((....)))))...(((((((......))))))).((........)).((((....)))).(((((((....)))))))((((.((((..(((((((((.....((((...(((.......)))....))))(((((((((..........))))).))))..((((...))))..........(((((((...((((((((...)))))))))))))))..........((((((((((((.(((((((((((((((((((((....)))......)))))...))))))...))))))).........))))))))))))..............(((((((((........))))))))))))))))))....)))).))))((..(((((((((((........)))))))))))..))((((((.......(((((.((......)).)))))))))))..))))))..(((((((((((((((((((....)))))...)))))))...............)))))))..)))))))).((((((.............(((((......))))))))))).......))))).....)))))...)).......',
  '................................(((((((........((((((..........)))))).(((.(((.((((((..........))))))))).)))...((((((((....((((.....))))..)))))))).........(((((((....)))))))(((((((((((.........))))).))))))....((((((.....((((.....))))))))))...(((....((((((((...))))).)))....))).((((........))))..)))))))....((((((((...............((.(((....))).)).((((((((........))))))))..(((((((.(((.............)))..))))))).((((((.((..((((((((((.....................)))))).)))).))..(((((....)))))...(((((((......))))))).((........)).((((....)))).(((((((....)))))))((((.((((..(((((((((.................................(((.(((((..........)))))..)))..((((...))))..........(((((((...((((((((...)))))))))))))))..........((((((((((((...((((.((((((((((((((....)))......)))))...))))))....))))...........))))))))))))..............(((((((((........))))))))))))))))))....)))).))))....(((((((((((........)))))))))))....((((((.......(((((.((......)).)))))))))))..))))))..(((((((((((((((((((....)))))...)))))))...............)))))))..)))))))).((((((.............(((((......)))))))))))..................................',
  '.......((((..(((.((((.........)))).))).)))).((..........)).....',
  '.(((..(((......)))...))).(((.(((((...(((((((.....)))))))..((((((....))))))((((((.((((((((.((.((((((.....(((...((((((.(((..(((((....((((((.....(((((.(((((((..(((((((..((..((((.....)))).(((((((......))).))))((((((.......))))))......)).)))))))....)))))))..))))).....(((((((((....(((...(((((....))))).)))..)).))))))).)))).)).....)))))..)))...))))))......)))))))))..)).)))).))))(((((.(((..(((((...((.((....)).))...)))))((((((.....))))))((((.(((((((.....)))))))))))((((((.(((((............)))))))))))))))))))...))))))(((........))).))))))))(((.((((......)))).((((((.......)))))).....((((((((.((....))))))))))))).',
  '.........................(((.(((((...(((((((.....)))))))......................................................................................(((((.(((((((..(((((((......((((.....))))......................((((((.......)))))).........)))))))....)))))))..))))).....(((((((((....(((...((((......)))).)))..)).)))))))..................((((..((((.....)))).))))............................................................((((((.....))))))((((.(((((((.....)))))))))))(((((.((((((............))))))))))).................(((........))).))))))))......((......))....(((((.......)))))......((((((((.(......)))))))))....',
  '......(((((....((((((........))))))...((((((.((..(((.(((((..(((......)))..))))).))).)).))))))........(((......)))(((((..((((...((((....(((((........)))))....))))..(((((...))))).(((((((.....)))))))..))))..)))))....(((((((.....((((..........)))).....))))))).)))))((((((((..(((((.(((....))))))))............(((((((((((.(((.((((((((.((((.......))))..(((((((((((.((((((((............................)))))))).)))).((((((((((.....((((........)))).))))).)))))....((..(((...((.((((.((.((((((...........)))))).)))))).)).)))..)).(((((....)))))...))))))).....(((((((....)))))))..(((((((((((((((((...((.(((((...(((((.........)))))....))))).)).......(((((..(((((........))))).......))))).((.(((((.((..(((.....)))..)).))))).))...............(((((((((...((((((.....(((....))).)))))))))))))))...........)))))).))))((((((..((((...((((((((.((((....(((.(((...(((((((((...(((.((((((....(((((....))))).((((((..((...(((((((........)))))))....)).)).)))).......)).)))).)))...)))))))))))).))))))).))...))))))...))))..))))))((((((.......(((...)))........))))))....))))))).......((((..(((((....(((((............)))))....)))))...))))..((((((((....((.....)).....)))).)))).(((.........))).......((((.(((.........)))))))...........))))))))))).)))))))).))).....((((((...((((((((((((((((((......))))).)).))...)))))..))))....)))))).((((((((.((((((.......))).)))..))))))))........((((((((.(((((((.......))))))).........((.(((((..((((......)).))..)))))))((((((.(((((((..(((...)))..))))))).))))))..((((((((...)))).)))).))))))))........))))))))...........',
  '...............((((((........))))))......................((((.((.((.........((((..((((......))))..)))).......)))).))))(((((............(((((........))))))))))......((((...))))(((((((((.....))))))).))..............(((((((.....((((..........)))).....)))))))......((((((((..(((((.(((....))))))))...............((((((((.(((.((((((((.((((.......))))..(((((((.(((.((((((((............................)))))))).)))..((((((((((.....((((........)))).))))).)))))........(((...((.((((.((.((((((...........)))))).)))))).)).)))......((((....))))....))))))).....(((((((....)))))))..(((((((((((((((((..............(((((.........)))))..........................(((((........))))).............((.(((((.((..(((.....)))..)).))))).))...............(((((((((...((((((.....((......)).)))))))))))))))...........)))))).))))((((((..((((...((((((.(.((((....(((.(((...(((((((((...(((.(((((((.(...........).)))((((((.......((((((..........)))))).......)).))))..........)))).)))...)))))))))))).))))))).)....))))))...))))..))))))((((((.......((.....))........))))))....))))))).......((((..(((((....(((((............)))))....)))))...))))..(((.((((....((.....)).....))))..))).(((.........))).......((((.(((.........)))))))...........))))))))))).)))))))).............................(((((((......))))).)).(((((((((.((.....))..)))...((((((((.((((((.......)))).))..))))))))..))))))((((((((.(((((((.......))))))).........((.(((((..((((......)).))..)))))))((((((.(((((((...(.....)...))))))).))))))..((((((((...)))).)))).))))))))........))))))))...........',
  '...(((((.((((.......(((((.....))))).........((((.((....)).)))).(((...)))(((.((((((((.((.(((...((...((((((((((.(((((...)))))..)))......((.(((((((......((((((((.(((((((((.((((((((((((((((......(((((((.......))))))).))))))........(((.(((((..((((((...........((((.((((....)).))..))))(((((..........)))))..(((.(((.((((((..........))))))))).)))...((((((((.....((((......))))))))))))......((((((((((....))))))).)))..(((((((....(((((.((((((((.....((((((.....((((.....))))))))))...(((....((((((((...))))).)))....)))...(((((((........))))))).)).)))))).)))))...)))))))..))))))..))))).)))((((((((........))))))))..(((((((((((.............)).))))))))).)))))).((..((((((((((.....................)))))).)))).))..(((((....)))))...(((((((......))))))).........((((.((((....)))).(((((((....)))))))((((.((((..(((((((((.....((((...(((.......)))....))))(((((((((..........))))).))))..((((...))))..........(((((((...((((((((...)))))))))))))))..........((((((((((((.(((((((((((((((((((((....)))......)))))...))))))...))))))).........))))))))))))..............(((((((((........))))))))))))))))))....)))).))))((..(((((((((((........)))))))))))..))((((((.......(((((.((......)).)))))))))))..))))....(((((((((((((((((((....)))))...)))))))...............)))))))...)))).))))))))).............(((((......)))))(((((......((((....))))((((((.(((((((.((((((((...(((((..((.((....)))).))))).(((((((..(((((.((((.....))))..)))))........(((((((...(((((.........)))))))))))).((((((.........))))))..)))).)))...(((((....)))))))))))))..........((((((.........)))))).....(((((((((.(((((((((..(((((((........))))))))))).....)))))....((((((((((((...(((((.....(((((...)).)))......)))))))))))))....)))).......((((((((((((((.((((((((............(((......)))............)))))))).)).............((((((((((....(((((.........(((((....(((....)))....)))))))))).)))).))))))...((((((........)))))).....)))))))))))).....((((.((.((((((.....((((..((((......))))..))))..))).))))).))))..)))))))))......(((((........)))))...)))))))))))))......(((((((((.....)))))).))).((((((((((....((((((.....((((..........)))).....))))))((((((((((((.....(((((.(((....))))))))..............((((((.....))))))..))).)))))))))..((.((.((((.((......))))))))))...........)))))))))).....)))))........((((((((((.....((((........)))).))))).)))))........)))))))).((((.((.((((((...........)))))).)))))).((((..((...(((((....))))).))))))((((....(((((((....)))))))....))))..((((.(((.(((((....((((.((((((((((...((.(((.........))).)).))))))).....))).)).))...))))).))).))))...((.(((((.((..(((.....)))..)).))))).))..)))))))))....(((((((((...((((((.....(((....))).)))))))))))))))...((((.((((((.(((......))).))))))..))))...)))).))).)).))).)))))))))).))).))))))))).',
  '...((((..((((.......(((((.....)))))...........(..((....))..)............(((.((((((((.((..(.....................(((.....)))............((((((((........))))))))..............(((((((((((((.......((((((.......))))))..))))))........(((.(((((..((((((..........((((((...(((((((........((((((..........)))))).(((.(((.((((((..........))))))))).)))...((((((((....((((.....))))..)))))))).........(((((((....)))))))(((((((((((.........))))).))))))....((((((.....((((.....))))))))))...(((....((((((((...))))).)))....))).((((........))))..)))))))......))).)))..............))))))..))))).)))((((((((........))))))))..(((((((((((.............))).)))))))).)))))))((..((((((((((.....................)))))).)))).))..(((((....)))))...(((((((......)))))))..............((((....)))).(((((((....))))))).......((((((((............................))))))))..(((.(((((..........)))))..)))..((((...))))..........(((((((...((((((((...)))))))))))))))..........((((((((((((...((((.((((((((((((((....)))......)))))...))))))....))))...........))))))))))))..............(((((((((........)))))))))......((......))...((((((((((((((((((........)))))))))))....((((((.......(((((.((......)).))))))))))).(((((((..(((((((((((((((((((....)))))...)))))))...............)))))))......((((.((((((.............(((((......))))))))))).....))))........(((((.((((((((.((((((((...(((((..((.((....)))).))))).(((((((..(((((.((((.....))))..)))))..((((...)))).....(((((.........))))).....(((((((....)))))))........)))).)))...(((((....)))))))))))))((.....)).((((((.........)))))).....(((((((((.(((((((((..(((((((........))))))))))).....)))))....((((((((((((...(((((.....((((.....).)))......)))))))))))))....)))).......((((((((((((((.((((((((............(((......)))............)))))))).)).............((((((.........(((..........((((......((....))......)))).))).......))))))...((((((........)))))).....)))))))))))).....((((.((.((((((.....((((..((((......))))..))))..))).))))).))))..)))))))))......(((((........)))))...)))))))))))))......(((((((((.....))))))).)).((((((((((....((((((.....((((..........)))).....)))))).(((((((((((.....(((((.(((....))))))))..............((((((.....))))))..))).))))))))....(.((.((((.((......)))))))))............))))))))))....)))))))...((((((((((((((.....((((........)))).))))).)))))........(((((.((..((((......(((...((((..(((............((.((((((((((((((....)))))...............(((((((....))))))).....)))))))))..)).....))).)))).))).(((((((.(..(.(((.........))).).))))))))...(((((........))))).............((.(((((.((..(((.....)))..)).))))).))...)))).)).)))))....))))...((((((.....((......)).))))))..)))))))..........((((.(((......))).))))........................)..)))))))))).))).)))).)))).',
  '......(((((..(((.....)))..)))))...((((((.(((((((((((.....((((((((....(((((.(((((.((......)))).))))))))......((.(((.((((((((((..((((.........))))))).))))).))))).))......((.((.((.((((..(((......)))..)))))).)).))))))))))((((...(((..(((((...))))).)))..))))....((((((((((.(((...))).)))))).....)))))))).)))))))(((((((.....)))))))......((((((........)))))).........((((((((..................)))))))).((.(((((((((((((((..(((((((.(((.(((.(((....))).)))..))).)))))))..)))).((.(((.....))))).(((((((((((((((..((((...)))).)))).((((((.....(((((........))))).(((((((..((..(((.....)))))..))))))).))))))..(((((((((((((..(((((........((.((((((((((((.....)))))....((((....)))).))))))))))))))..))).))..))))))))...)))).)))))))..((((.........))))......((.((((.......((((......((((.....))))...((((((((((........)))))....))))))))).......)))).)).)))).))))))))).......(((((.....)))))(((((..(((((.((...)))))))..))))).....)))))).(((((...((((......))))((((((...........))))))......((((.((((............)))).))))...........)))))......((((((.((....)).))))))....',
  '.(((((.((((..(((.....)))..)))).....(((((.................((((((((....(((((.(((((.((......)))).)))))))).........(((.((((((((((..((((.........))))))).))))).))))).........((.((.((.((((..(((......)))..)))))).)).))))))))))((((...(((..(((((...))))).)))..))))....((((((((((.(((...))).)))))).....))))............(((((((.....)))))))......((((((........)))))).........((((((((..................)))))))).((.((((((((((..............................((((....)))).(((((((((.....((.(((.....))))).((((((.(((.((((..((((...)))).)))).((((((.....(((((........))))).(((((((..((..(((.....)))))..))))))).))))))..(((((..((((((..(((((...........(((((..(((((.....)))))....((((....))))...)))))..)))))..))).)))....)))))....)))..))))))......((.....................)).........))))))))).....................(((((........))))).............................))).)))))))))......((((((.....)))))).......((((........)))).............))))).))))).....(((......))).((((((...........))))))......((((.((((............)))).))))......................((((((..........))))))....',
  '((((((((.(((((.(((((.((((((...(((((.......))))).)))))).)))....(((.((((((....)))).)).)))(((((.......))))).((((.(((((((((.....))..(((((((((((((((..((((((.((((....((((((...(((((((......))))))).....))))))((((......)))).....((((((((...)))))))).......((((((((((.((((....(((((...)))))..)))).)))).......((..((((((.....))))))..))(((((((((((..(((((((((((((((((......)))...........))).)))))).((((((........((..((((((....))))))....))))))))...(((((((.((((((....)))..))).)))))))...(((((((......)))))))((((((((..(((...((((((((...((((((.....((((((.......))))))..))))))(((((.....))))).....((((((((.....))))))))(((((((.......)).)))))(((.(((((((((((((((((((((((....((((.((((((.(((((..(((..(((((....(((....)))..((((.((((.((((((((((((..((((.(((.....))).))))((((((((....)))).))))......((((((((((.......)).))).)).))))))))))))))))))).))))))).))..)))))).)).)))))))).))..(((((((....))))))).)))).)).)))).))).....(((.((.(((((((((.........))))))))).)).)))......))))))))))))).((((((((((((((....((((....)))).(((((....)))))...)))))))..))))))).....(((((.......)))))..(((.((((((((((((.........)))....))))))))).)))))))))))(((.....)))..(((((((..........))))))).........(((((((((((((.......)).)))))))....))))........(((((....(((((.......))))).....))))))))..))))))))))))))))))).)))))..(((........))).))))))...)))).)))))).))...)))))))))).))).....))))))))).)))).))))).))))))))((((((....(((((.....((((((((......)))).))))))))).))))))(((.....)))...........',
  '(((((..((.((((((..........))))))..)))))))...........((((((.((((((((...(((((....))))).............(((((.((((((...((((.(((..(((....))).((((((......))))))(((((.....)))))((((((((...))))))))....)))))))..(((((.((.(((..((((((.((((((............)))))).))))))))).)).)))))......))).)))..))))).....))))))))..))))))..',
  '.(((((((..((((((.......(((((((((....)))))))))....))))))(((((((((((..((....)).)))))))).))).....)))))))(((((((.(((.((((...((((((.....((((((((((.(((((((..........))))))))).)))))))).(((((((((.((.(((...(((((....(((((.....((((((..(((.((((..........((((...(((...))).))))...))))..)))..)))))))))))))))).)))...))))).)))))).))))))..((((((((((((..((.((.(((((.....))))))))).......((((((((....((((.....((((((((((((..((..(((((((............(((((((...((((.....)))))))))))))))))).)).))))).)))).)))......))))..))))))))(((......((((((......)))))).........))).))))))))))))))))...))).(((((......)))))......((....))((((...))))((((((((.((((....))))...)))))))).........)))))))....',
  '..........((((((.......(((((((((....)))))))))....))))))(((((((((((..((....)).)))))))).)))...((((((((...........)))))))).((((((.....((((((((((.(((((((..(......)))))))))).)))))))).(((((((((.((.(((......................(((((.......((((..........((((...(((...)))..))))..))))........)))))...........)))...))))).)))))).))))))..((((((((((((..(((.(.(((((.....))))))))).......((((((((....((((.....((((((((((((..((..(((((((............(((((((...((((.....)))))))))))))))))).)).))))).)))).)))......))))..)))))))).........((((((......)))))).............))))))))))))...........(((((......)))))......((....))((((...))))((((((((.((((....))))...)))))))).(((......))).......',
  '...(((((((..((((.(((..((.((((......(((...((...((((((....))))))...))..)))......))))))..))).))))..)))))))....(((...(((((.....(((((...(((..((.((.(((((...........(((((..((((.......(((.((...((.((..(((((((((((.......)))))).)))))..))))...)).))).......))))..))))).((((((....)))))).((((((((((((.......(((((.....)))))....(((((......((((((..(((((.....((....(((((((.((((((.....)))))).((((.((((.....)))).))))((((....))))...)))))))...))))))).))))))((((((....))))))....(((((..........(((...(((((((((((((...((((((.((.((.....(((((.......))))).((.(((((.((((...(((.((.(((..((((....))))..)))..((((((......))))))((((((((..(((..(((...........)))...)))......(((((((.........)))))))))))))))..)).))).))))..)).)))))......((((.(((((....))))).))))(((((.(((((.((.(((.......))).)).))....((((((((.....((((....)))).))).)))))...))).))))).)).))))))))...)))))).)))))))..)))(((((((...)))))))))))))))))))))))))......))))..))))).)).)).)))..)))))......))))).....((((((((((((...)))))))))))).)))...',
  '...(((((((..((((.(((.....((((.................((((((....))))))................))))....))).))))..)))))))...............................((((..(..((.((.......))..))...)..)))).....................(((((((((((.......)))))).))))).............((((((...))))))......((((((....))))))......((((((........(((((.....)))))...............((((((..(((((...........((((((.(((((((.....)))))).)......................((((....))))....)))))).....))))).))))))((((((....)))))).........................(((((((((((((...((((((.((.((..............................................(((..((((....))))..)))..((((((......))))))((((((((..((...(((...........)))....))......(((((((.........)))))))))))))))......................................................((((....((.((.(((.......))).)).))....(((((........((((....)))).....))))).......))))..)).))))))))...)))))).))))))).....(((((((...)))))))...........))))))...................................................((((((((((((...))))))))).)))......',
  '............(((((((((.....(((((((...)))))))((((.((((((..........(((((......((..(((((..((((.......((.((....)).)).(((((.((((.(((..(((..((((.(((..(((((((.(((.(((....))).))).)))))))...))).)))).)))..(((((.((((((((((....(((.((((.((.(((.(((((....)))))))).)).)))).)))...))))))))))..)))))(((.....)))....(((....)))..))).)))).)))))..((((((((...))))))))((((...(((........)))..)))).(((...((((.((.(((.((((((((.((((((...)))))).)))))))).)))))..))))...)))....((((......))))((((((.(((....))).))).)))))))..)))))..))....))))).((((((..(((((((...(((.(((((...(((((((.(((..((.(((((((((((((......))))))..(((((.(((((.(((((....))))).))))).))))))).))))).))....)))))))))).))))).)))..))))))).))))))..)))))))))).......(((((.((((.((((((.((.........)))))))).(((((.((.((((.......((((((((.....((((((((((...(((.((((.(((.....))))))).)))...)))))))...)))....))))).)))...)))).))..)))))..)))).)))))..(((((((....))))))).(((((((...........)))))))(((.(((.(((....((....))..)))))).))).(((((((.....))))).))))))))))).....',
  '........((((((....))))))......((((((((.....(((.((((.(((((((((.(((((((((((..((....)).)))))).((.((((.(((((.....))))).))))))..)))))))))))))).)))))))..(((((((((((.......((((.(((.((.((((....)))).))))).)))))))..))))).)))((((((((...((((.((((((.(((((((.((.(((((((..((((.((((.(((((((....))))).)))))).))))..))))))).)).))).)))).)))))).)))).......(((((((((.........))))))))).(((((((((.((.(((((.(((((.((((.....))))...))))).(((...((((.(((((((.((.(((.((.((((((.(((((...........(((((....(((((......))))).)))))...))))).)))))).)).))).)).))))))).)))).)))...............((((((((......(((....((((((..((((((((.....((.....))......)))))))).))))))))).....))))))))..((((((((.(((..((((((................)).)))).))))))))))).........((((((..(((((((...(((.((((((((((((((((.....)))))........(((..((((.(((((((((..((((((((((((.......(((.((((....((((((.....)))))).)))).)))(((((((((...((...))...)))))))))...)))))).(((((.(((((((((.((((.((..((((.(((((((((.((((..(((..((.(((....((((((((((((((...(((((((..((((((..((....))..))))))...)).)))))....)))))))))))))).....)))))..)))..))))))).))))))..)))).)).))))))))))))))))))..)))))).))))))))).)))))))))))...))))))))))..)))((((.(((((((.(((..((.......))..)))...)))))...))))))..)))))))))).(((((((((.((((((..(((((..((((((((((..(((((.......((((((((((((((.((...)).)))))))))))))))))))...)))))))....))))))))........))))))..((((((((((((((((((.....(((..((((((.....)))))).))).....)))))..))))).)))))))).))))))))).)))))..)))))))))))......))))))))......((((((((((((((((((..(((((((((((((..((((((((..........(((((((....))))))).(((((((((.((........(((((((((........)))))))))..))))))))))))))))))).)))))))))))))..))))))))..))).)))...))))...))))))))',
  '...((((((...(((((..((((((((((..((((((((.((((............((((((((....)))))))).........))))..))..))))))..)))...((((((.((((((((((((((((.(((((((((((...(((((.(((((.....))))).)))))...))))).)))))).)))))))))).)))))).((((((...((((((((.((((.......))))))))))))...))))))((((...(((((.((...)).))))).....))))(((....)))................(((((.((((((((((.(((((................................(((((((.....))))))).............((((.................)))).....(((((((((((..((((((.(((....(((((...)))))..)))..(((((........))))).....)))))).)))))))))))(((((((.((.(((.(((.....(((((.....)))))....))).))))))))))))...((..............))..........))))).....(((((.....)))))....((((((...(((((((..((((..(((((((((((((.......(((((((.....(((((((...)))))))..))))))).((((((((...((...))...))))))))....)))))).((((((..(((((((((((....(((.(((((...((((.(((((..((.((.(((((...((((((((((((.....(((((((((((.(((((((....))))))).)))))))))))......)))..)))))))))....))))).)).)).)))))))))....))))))))....))))))))))).))))))..)))))))..)))).)))))))...)))))).........(((.....(((...)))...)))...............))))))))))..)))))................................))))))....((((((((((((((.......(((((((((((((((((.......)))))))))))))))))))))).))))))))).)))))))..)))))......))))))((((((.((((((......((((((((((((((((....))))...)))).))))))))))))))..))))))...',
  '...((((((..((((((..((((((((((..((((((((.((((......((((..((((((((....)))))))).....))))))))..))..))))))..)))...((((((.((((((((((((((((.(((((((((((...(((((.(((((.....))))).)))))...)))).))))))).)))))))))).)))))).((((((...((((((((.((((.......))))))))))))...))))))((((...(((((.((...)).))))).....))))(((....))).(((.((.((((((......(((.((((.(((....((((......))))....(((((((((((((((..((((((((((.(((....)))((((((....((((...(((........))))))).....(((((((((((..((((((((((....(((((...)))))..)))).(((((........))))).....)))))).)))))))))))(((((((.((.(((.(((.....(((((.....)))))....))).))))))))))))..((((.((......)).)))).....((((.((((.....(((((.....)))))....((((((...(((((((..((((..(((((((((((((.......(((((((.....(((((((...)))))))..))))))).((((((((...((...))...))))))))....)))))).((((((..(((((((((((....(((.(((((...((((.(((((..((.((.(((((...((((((((((((.....(((((((((((.(((((((....))))))).)))))))))))......)))..)))))))))....))))).)).)).)))))))))....))))))))....))))))))))).))))))..)))))))..)))).)))))))...))))))....)))))))).....(((...)))..))))))....))))))))))....)))))))))))))))))).))))))))))))).))...)))...))))))....((((((((((((((.......(((((((((((((((((.......)))))))))))))))))))))).))))))))).)))))))..))))...))..))))))((((((.((((((......((((((((((((((((....))))...)))).))))))))))))))..))))))...',
  '((.(((((((....((......))...)))))))(((((((((........)))).))))).((((((((((((((.(((((((((((.((((((..(((((((((((........)))(((((((.....))))))).((((((....))))))....((.((((((.....((((((((..................)))))))).....)))))))).(((((..(((((((.(((.(((.(((....))).)))..))).)))))))..)))))((.(((.....)))))((((((((..(((.........))))))).)))).((((((.....(((((........))))).(((((((..((..(((.....)))))..))))))).))))))..(((((((((((((..(((((........((.((((((((((((.....)))))....((((....)))).))))))))))))))..))).))..))))))))....)))))))).))..((((.........)))).......)))))))......)))))))).)))....((((((((..((((((((((........)))))....)))))(((((..((((((....)))))))))))...........((((((.....)))))).(((..(((((.((...))))))).)))..(((((.....))))).)))))))).......)))))(((((...........)))))........(((.((((............)))).))))))))).................((((((.((....)).))))))))..',
  '........................((((((.(((((...(((..(((((...))))).)))..)))))....(..((((((.(((...))).)))))).......).((((....))))(((((((.....)))))))......((((((........))))))..)))))).((((((((..................))))))))......................................((....)).........................((.(((.....))))).((((((.(((.((((..((((...)))).)))).((((((.....(((((........))))).(((((((..((..(((.....)))))..))))))).)))))).........((((((..(((((..................(((((.....)))))....((((....))))..........)))))..))).))).............)))..)))))).................................................................((((((((((........)))))....))))).......(((((......)))))................((((((.....))))))......(((((.((...)))))))......(((((.....))))).................................................((((.((((............)))).))))......................((((((.((....)).))))))....',
  '.........(((((((....))...)))))....((((((((..((((((.....((((((((.....))))))))..........))))))((.(((((((((.((((((...........((((((......)))))).))))))..)))...))))))))(((((((((((.((....)).))))(((((..........)))))........)))))))))))))))..(((...((((((........((((((((..............)))))))).....))))))....)))......',
  '.........(((((...........)))))....((((((((..((((((.....((((((((.....))))))))..........)))))).(.(((((((((.((((((...........(((((........))))).))))))..)))...))))))).(((((((((((.(......).))))(((((..........)))))........)))))))))))))))..(((...((((((........((((((((..............)))))))).....))))))....)))......',
  '.............(((.(((....((((.((((.(((...((((((..(((.(((........((((((((..((((......(((((.......)))))((((((((((..((((.(((((((((.....)))).))))))).))((((((((.(((.......(((((((......)))))))..(((((((((((((......)))).....((((((((...))))))))........((...((((.((((....(((((...)))))..)))).))))....)).((..((((((.....))))))..))((((((..(((..((.(((.(((.(((((.((((((.......(((.(((...))).)))......)))))).))))).))).)))))..)))......)))))).....(((((((.((((((....)))..))).))))))).....)))))))))((((.((.(((((..........)))))..))))))((((((.....((((((.......))))))..))))))(((((.....))))).....((((((((.....))))))))(((((((.......)).)))))(((.(((((((((((((((((((((((....((((.((((((.(((((..(((..(((((....(((....)))..((((.((((.((((((((((((..((((.(((.....))).))))((((((((....)))).))))......((((((((((.......)).))).)).))))))))))))))))))).))))))).))..)))))).)).)))))))).))..(((((((....))))))).)))).)).)))).))).....(((.((.(((((((((.........))))))))).)).)))......))))))))))))).((((((((((((((....((((....)))).(((((....)))))...)))))))..))))))).....(((((.......)))))..(((.((((((((((((.........)))....))))))))).))).))).))))))))....))))))))))....)))).))))))))..........))))))..)))).))...))).)))))))).......))).)))...',
  '((((..(((..((((.(((((...(((((..(((((((........))))((((((((.((.............))..))))))))..(((((...((((((..((..((((((((......(((((((((((((.......)).)))))))....)))).........))))))))(((((.......)))))(((((....)))))....(((((((((....(((((.(((((((.....(((((((.(((((((..((((.............))))..))))).(((((((....(((.......)))...)))))))..((((((....(((((.....((((((((......)))).))))))))).))))))....))..))))))))))))))....))))).....((((((((((((((((..........)))))..)))..))))))))......(((..((((..((((...))))..)))).)))..))))))))).....))))))))...))))).....))).)))))....))))).((((.....(((((((......))))))))))))))).)))..))))....',
  '((((..(((..((((.(((((...(((((..(((((((........))))((((((((.((.............))..))))))))..(((((...((((((..((..((((((((......(((((((((((............)))))))....)))).........)))))))).((((.......)))).(((((....)))))....(((((((((.....((((.(((((((......((((((...(((((..((((.............))))..))))).(((((........................)))))..((((((.(..(((((.....((((((((......)))).))))))))))))))))........)))))).)))))))....))))......((((((((((((((((..........)))))..)))..)))))))).........((((((..((((...))))..)))).))...))))))))).....))))))))...))))).....))).)))))....)))))..........(((((((......)))))))....)))).)))..))))....',
  '......(((((((((.....((..(((...((.((((.((.((((((...........)))))).)))))).)).)))..)).(((((....))))).......((((....(((((((....)))))))....))))))))))))).....((((((..............)))))).',
  '.......(((((((.((((((((((.(((................))))))..)))))))..((((((..((..((((....((((((((((.....((....)).....(((((.((....))))))).....((((((((...))))))))((((((((..((((.......))))..)).))))))(((.((.(((..((....(((((...((((((((((..........)).)))))).))....)))))..))))).)).))).....(((((((.....)))))))..))))))))))....))))..)).)))))).......((((((...))))))(((((((((((((.((((...)))).)))))......))))))))...(((((.(((....((((.....)))).((((.((((..((........((((((.......))))))..)).))))..))))...((((.(((((((((.......(((((((((....(((...(((((....))))).)))..)).)))))))..((((.((((.......((((..((((.....)))).)))).((((((((.((((....((((((((.((....)).))))))))..))))))))..))))((((((.....))))))((((.(((((((.....)))))))))))((((((.(((((............))))))))))).)))).)))).))))......))))).))))))).))))).))))))).......(((..(((((.......))))))))...((((((((.((....))))))))))....',
  '.......(((((((.((((((((((.(((................))))))..)))))))..((((((......((((....((((((((((.....((....)).....(((((.((....)))))))......(((((((...))))))).((((((((..((((.......))))..))).)))))............(((......)))....((((((...............))))))................((((((...))))))(((((((.....)))))))..))))))))))....)))).....))))))......................(((((((((((((.(((.....))).)))))......))))))))...(((((..((....((((.....))))......................((((((.......)))))).......................................((((((.....................................))))))..((((.((((.......((((..((((.....)))).)))).((((((((.((((....((((((((..........))))))))..))))))))..))))((((((.....))))))((((.(((((((.....)))))))))))(((((.((((((............))))))))))).)))).)))).....................))..))))).)))))))............(((((.......)))))......((((((((.(......)))))))))....',
  '.....(((((((..((.(((....((((((....))))))..))).))))).))))((((((((.(((((.((((((.((......))...((.(((.....)))))..........(((((((((((....))))))).))))))))))(((((.((.((((((...((.(((((....(((((............(((((((((....))).....(((.((((.....)))).)))))))))...)))))...))))).))....)))))).))..)))))..((((((.......))))))((((((.........)))))).....(((......))).))))))))))))).....',
  '.....(((((((..((.(((.....((((......))))...))).))))).)))).(((((((.((.(((((((((..............((.(((.....)))))..........(((((((((((....)))))))).)))))))))......................................................((....)).......((.((((.....)))).)).................................................(((((.......))))).((((((.(......)))))))...............)))...)))))))))......',
  '............(((((...............((((.(((((((((((........)))..(((((.....((((((((.(((((........)))))...((((..((......))....))))...(((((((((((.((((.(((.(((((((.....)))))))((((((.(((((((((((((((((..((((......))))))))..((.(((((((((.((((..(((.(((((.(((.(((...)))))).((((.(((((....)))))))))(((((((((..(((.......))).))).))))))))))))))..))))..)))).)))))..))...((((.(((.((.......)).))).....(((.((((..((((...))))....)))).))).......))))((((((.(((..(((.(((((...))))).)))..)))))))))))).))))............(((((.(((((...(((.(((((.((......)).))))))))...))))).)))))))))))..))))))............((((((........))))))....))))))).))......))))).))))))))))...)).....)))))...))))))))..)))).....(((((..((.((((.........)).))..)).)))))..((((((.(((..........((.((((..((((((((...((......))..))))))))..)))).))...(((...(((((((........))))))).))).....(((......))).(((((........)))))(((((((((.........))))))))).....((((.(((((......(((....)))......))))).)))).))).)))))).....(((((((((((.....)))))))))))))))).',
  '............(((...................(..(((((((((((........)))..(((((.....((((((((..((((........))))......(((..(......).)))........(((((((((....(((.((..(((((((.....))))))).(((((.(((((((((((((..................((((((.....(((((((((.((((..(((.(((((..................((((.(((((....)))))))))(((((.(((..((.........)).)))..)))))))))))))..))))..)))).)))))....................................(((.((((..((((...))))....)))).))).....))))))(((((.((((..(((.(((((...))))).)))..)))))))))))).))))............(((((.(((((...(((.(((((.((......)).))))))))...))))).)))))))))))..)))))...........(.((((((........)))))).)...)))))..........))))).))))))))))...)).....)))))...))))))))...).......(((((..((.((((.........)).))..)).)))))..((((((.(((..........((.((((..((((((((...((......))..))))))))..)))).)).........(((((((........))))))).........(((......))).(((((........)))))(((((((((.........))))))))).....((((.(((((......(((....)))......))))).)))).))).)))))).........(((.............)))......))).',
  '(((...(((((.(((((.....))))).)))))...)))...(((((((((((((((((((((...(((((((...((((((((.((((.......))))))))))))...)))))))))))).(((((.((...)).)))))....)))))).))...(((((...((((((.(((..((((((.....(((.....((((......)))).....)))............(((((((.....))))))))))))).)))))))))....)))))..................))))))))...((((........))))(((((...)))))...((..(((((........))))).))....',
  '............(((((.....)))))...............((((((..(((((((((((((...(((((((...((((((((.((((.......))))))))))))...)))))))))))).(((((.((...)).)))))....)))))).))...(((((...(((((..(((..((((((.............((((......))))....................(((((((.....))))))))))))).))).)))))....)))))....................))))))...((((........))))................((..(((((........))))).))....',
  '((((.((((((.(((...((((((((...(((((((.....(((((.(((((((.(((((.((.(((((((((........(((((((....)))))))....((((((((...........(((((((........)))))))...))).)))))..)))))))))))))))).))))))).))))))))))))....))))))))..))).))))))..))))((((.......))))((((((((.((((.(((((.(((.(((.((((((....)))))).))).)))..)))))..)))).(((((((((((((..(((..((((((((..(((.(((((((((......))).))))))(((((((((((.....((.(((((((...)))))))((((...)))).........)).....)))))))))))..)))..))))))))..)))...))))))).))))))..))))))))....((((((...((.((((((((((((((....)))))))).))))))))...))))))',
  '.......(((((((((((.....(((((.......)))))..))))))))))).....',
  '.....(((((((...(((((..(((((((...((((.(((((..(((.(((...((((........)))).))).)))))))).))))..)).))))).....(((((..........)))))....(((((((((....))).)).)))).((((......))))..)))))..)))))))................(((((((((..((......((((((.((((((((.(((.(((..((((.((((.....((((....))))......)))).))))..)))))).))..))))))..)).)))).(((((......))))).((((((((.........)))))))).))..)).)))))))..(((((((((((.....(((((.......)))))..))))))))))).....',
  '.....(((..(((((..((((.((.((.(((..(((((....))))).))).)).)).))))...((((((((((((((((((((((.(((((((...((((((((((((((.......(((((((((((((((((.......)))))))))))))))))))))).))))))))).....)))))))..)).)).)).....((((((.((((((......((((((((((((((((....))))...)))).))))))))))))))..))))))..))))))))..((((.......))))((((((.(((...((((((((...(((((((.....(((((.(((((((.(((((.((.(((((((((........(((((((....)))))))....((((((((...........(((((((........)))))))...))).)))))..)))))))))))))))).))))))).))))))))))))....))))))))..))).))))))....((((((.......)))))).......((((.(((((.(((.(((.((((((....)))))).))).)))..)))))..))))...))))))))((((.((((.......)))).))))...(((((......))))))))))...))).((((...(((..(((((((...)))))))..)))...)))).............',
  '.............((((((....((((....))))..))))))........((((((.(((((...(((((..........(((((..(((((((.(((((((((((((((...)))))..)))).((((.(((.((((.....))))))).))))..)))))))))))))..)))))....(((((((.((((......((((..((((((((....)))))))).....))))))))..)))).)))))))).)))))((((..((((((((((((((((.(((((((((((...(((((.(((((.....))))).)))))...)))).))))))).)))))))))).))))))..)))).....(((((((.((((.......)))))))))))((((((((((((((...(((((.((...)).))))).....)))))..))..))).))))...........((((((((((((((((((((((((.(((.....(((((((((............(((((((.....)))))))..)))).))))).((((...(((........))))))).....(((((((((((..((((((((((....(((((...)))))..)))).(((((........))))).....)))))).)))))))))))(((((((.((.(((.(((.....(((((.....)))))....))).))))))))))))..((((.((......)).))))...))).))))))))....(((((.....)))))....((((((...(((((((..((((..(((((((((((((.......(((((((.....(((((((...)))))))..))))))).((((((((...((...))...))))))))....)))))).((((((..(((((((((((....(((.(((((...((((.(((((..((.((.(((((...((((((((((((.....(((((((((((.(((((((....))))))).)))))))))))......)))..)))))))))....))))).)).)).)))))))))....))))))))....))))))))))).))))))..)))))))..)))).)))))))...)))))).((((((..(((.....(((...)))...)))..))...))))....)))))))))).))))))))))))...(((((.((((((((((..(((.....))).....)))..))))))).)))))',
  '.............((((((......(......)....))))))...............(((((...(((((........(.(((((..(((((((.(((((((((((((((...)))))..)))).((((.(((.((((.....))))))).))))..)))))))))))))..))))))...(((((((.((((............((((((((....)))))))).........))))..)))).)))))))).)))))......((((((((((((((((.(((((((((((...(((((.(((((.....))))).)))))...))))).)))))).)))))))))).))))))...........(((((((.((((.......))))))))))).((((((..(((((...(((((.((...)).))))).....)))))......))).)))............(((((.((((((((((.(((((((..((..........................(((((((.....))))))).............((((.................)))).....(((((((((((..((((((.(((....(((((...)))))..)))..(((((........))))).....)))))).)))))))))))(((((((.((.(((.(((.....(((((.....)))))....))).)))))))))))).........................))..))))))).....(((((.....)))))....((((((...(((((((..((((..(((((((((((((.......(((((((.....(((((((...)))))))..))))))).((((((((...((...))...))))))))....)))))).((((((..(((((((((((....(((.(((((...((((.(((((..((.((.(((((...((((((((((((.....(((((((((((.(((((((....))))))).)))))))))))......)))..)))))))))....))))).)).)).)))))))))....))))))))....))))))))))).))))))..)))))))..)))).)))))))...)))))).........(((.....(((...)))...)))...............))))))))))..)))))..........(((...(((((............................)))))...))).',
  '..(((..(((.((..((((((..(((((((...(((.(((((...(((((((.(((..((.(((((((((((((......))))))..(((((.(((((.(((((....))))).))))).))))))).))))).))....)))))))))).))))).)))..))))))).)))))).(((((.((((........(((((.((((.((((((.((.........)))))))).(((((.((.((((.......((((((((.....((((((((((...(((.((((.(((.....))))))).)))...)))))))...)))....))))).)))...)))).))..)))))..)))).)))))..(((((((....)))))))...)))).))))).......((.((((((.....))))))...))...(((((.((((((..((...))..))))))....))))))).))).)))',
  '((((....))))...((((.(((((((((.((((.((..((((.(((((((((.((((..(((..((.(((....((((((((((((((...(((((((..((((((..((....))..))))))...)).)))))....)))))))))))))).....)))))..)))..))))))).))))))..)))).)).)))))))))))))))))(((.((..((((....((.((((......)))).)).............((((.(((((((.(((..((.......))..)))...)))))...))))))......((((((...........))))))))))..)))))............',
  '...((((((((((..((((((..((((....)))).((((((((((((((..(((((((((((((..((((((((..........(((((((....))))))).(((((((((.((........(((((((((........)))))))))..))))))))))))))))))).)))))))))))))..))))))))..))).)))........)))))).)))).))))))((((.....))))(((((.((((((((.((.(((((.((....))..)))))))..........(((((..((((((......(((...)))..))))))))))))))))))).)))))(((((....)))))..',
  '....(((.(((((........((((.(.((((((..(((.(((....))))))....)))))).).))))(((((((.((((((((.........))))))))))))))).))))).)))',
  '........(((((....(((((..((((((.....)))...((((....((((((((....))))))))))))...(((((((.....((((((.((.((....)))).))))))...............)))))))....(((((.(((...))).))..))))))..)))))..(((((((((((((.....((.((..........))))))))))))))))))))))......................(((((((((((((((............))))).((((.((((((.......))).)))...))))((((((((((..............))))))))))...((((..((.....)).))))((((....)))).......(((((....)))))...((((.......)))))))))))))).........((((((((......)))))))).....(((((((......)))))))..',
  '........(((((....(((((..(((..............((((....((((((((....))))))))))))...(((((((.....((((((.((.........)).))))))...............))))))).......((.(((...))).)).....)))..)))))..(((((((((((((........................))))))))))))))))))......................(((((((((((((((............))))).((((.((.(((.......)))..))...))))((((((((((..............))))))))))....(((............)))..............(((...(((((....))))))))..((.......))..)))))))))).........((((((((......)))))))).....(((((((......)))))))..',
  '.........((((.((((((.......))))))..))))...........(((((.............))))).....(((((..(((((.((((((((.....))))..)))).))))).)))))......(((((.((((((.(((.((......))...))).)))).)))))))..',
  '.........((((.((((((.......))))))..))))..............................((((((.((....)).)))))).......((((.....)))).....................(((((.((((((.(((.((......))...))).)))).)))))))..',
  '........(((((((.......)))))))...((((((((.((((((((......(((.((((...................)))).)))......))))))))....))))))))..........((((.((((....(((((....(((((.((((((((((((.((((((((............))))))))..........)))))))).......((((((((((((((((......))))))))).....((((....)))))))))))...............)))))))))...)))))...))))...))))......(((((((((..((.(((......))))))))))..))))..',
  '........(((((((.......)))))))...((((((((.((((((((......(((.((((...................)))).)))......))))))))....))))))))...............((((....(((((....((((.(((((((((((((.((((((((............))))))))..........)))))))).......((((((((((((((((......))))))))).....((((....)))))))))))...............)))))))))...)))))...)))).............(((((((((..((.(((......))))))))))..))))..',
  '......((((((((((..............))))).))))).....................((((((..((.............))..))))))..((((((....(((((((........(((((((...)))))))........)))))))....)))))).((((......)))).',
  '.......(((((((((..............))))).))))......................((((((..((.............))..))))))..((((((....(((((((........(((((((...)))))))........)))))))....))))))................',
  '((((((...((((((..............(((((((.(((.(((((........)))))..)))))))))).......))))))..(((((((..........))))))).....((((.((......)).))))...........................((((.(((..((((((....))))))..))).))))((..(((.((...((((((((((...)))))))(((((((..(((((.....))))))))))))...............)))...)))))..)).......))))))...',
  '((((((...((((((..............(((((((.(((.(((((........)))))..)))))))))).......))))))..(((((((..........)))))))..........((......))................................((((.(((..((((((....))))))..))).))))................(((((((...)))))))(((((((..(((((.....)))))))))))).....................................))))))...',
  '...((((.........)))).((((((((((((((....))))))((((...((((....))))..))))..((((.((......)))))).(((.((((...))))..)))((((((((((.......................))))))))))((((((..((..((..(((.((..(((((((((.((....)).)))))))))..)).)))..))..))))))))..(((((((....((.....))....)))))))....(((((....))))).))))))))..((((...))))..',
  '(((((((((.....(((((((.............((((..(((....((((...))))...)))..))))...((((.....)))).)))))))((((((((((((((..((((((...))))))))))))))...)))))).((((((((.........((((.((((((((...)))).)))).))))....))))))))((((((((((..((((((((((((((((......))))))))..))))))))....))).....(((((.(((((((((..........)))))))))))).))......((((.((((.......(((((...))))).....)))))))).)))))))((((((((((...........))))))))))..))))....)))))..((((.((((.((((....))))...)))).))))..(((((.(((..............))))))))..',
  '..................................((((............................))))........................((((((((((((((..((((((...))))))))))))))...))))))..................((((.((((((((...)))).)))).))))........................((((((((((((((((......))))))))..))))))))................(.((((((((............))))))))).............................................................((((((((((...........))))))))))..................(((.((((.((((....))))...)))).))).........(((..............))).......',
  '...((....)).((((((.(((((.((.(((((((((......)))).))))).))))))).((((.(((((((((((........)))))..)))))).))))((((((((((....)))).)))))).....((((............))))......(((((((.......(((((((......))))))).....((((......)))))))))))...............((((((((..((..............((((((((((((((....))))))..))))))))...........((((((.....(((......)))..)))))).....)).)))))))))))))).....',
  '(((((.......)))))......................................((((((((...((((((....((((.............((((((...(((((.((((.(((((.......))))).)))).)))))..)))))).((((((.....((((((((.(((((....)))))...)))).)))).))))))............((((((.(((((((((((....)).))).)))))).))))))............((((..................)))).........(((((((((...((....))....))))))))).......))))...))))))))))))))',
  '(((((.......)))))........................................(.............................).......((((...(((((.((((.(((((.......))))).)))).)))))..))))...((((((.....((((((((.(((((....)))))...))))).))).))))))............((((((.(((((((((.........))).)))))).))))))............((((..................)))).........(((((((((...((....))....)))))))))............................',
  '.(((((...(((((((...(((((((...(((((((((.((.(((....))).)))))))))))....))))))).....))))))).........(((((((((((..((.(((..(((......)))))).))..)))).))))))).......(((..(((...((((((((.(((.((((.(((....))))))).)))((((((((.............((((..(((....((((...))))...)))..))))...((((.....)))).)))))))))))))))))))..))))))))..',
  '..(((....(((((((...(((((((...(((((((((.((.(((....))).)))))))))))....))))))).....))))))).........(((((((((((..((..((...((......)).))..))..)))).)))))))............(((...((((((((.(((.((((.(((....))))))).)))((((((((.............((((..(((....((((...))))...)))..))))...((((.....)))).)))))))))))))))))))......)))...',
  '(((....((((((...))))))...)))...........((((((...((((((.((((((((.(((((((((............(((......))).((((...((.((((((((((.(((((((((((.....(((((...(((((.....)))))....)))))...))))))))))))))))))))).)).)))))))))..(((.(((((((((......)))).))))).))))))).)))))))).)).))))...))))))..((((((((.(((.((((((((((((.(((..(((((((......))).))))...)))))))))).)))))(((((((.......(((((((......))))))).....((((......))))))))))).........))).))))))))..',
  '.........................(((.(((......))).))).................((((..(((((.............(((((((((..........((.((((((((((.(((((((((((.....(((((((.(((((.....))))).)).)))))...))))))))))))))))))))).))........(((.(((.(((((((((......)))).))))).))))))....((.(((((((((((........)))))..)))))).))..........................................))))))))).............)))))...(((((((......)))))))...............))))..............................',
  '...(((((((.((((..((((((((..................))))))))......)))).))))))).......(((..((((..(((((((((.((((...........))))))))).)))).....)))).)))..((((((....(((((.((((...)))).)))))..((((((..(((((((((....)))))))))....))))))...((((((......)))).))((((((((((((...))))))).))))).(((((.(((((((((((((...(((.((.....)).)))...)))))))(((((.((.(((((.((.((....)).)).))))).)).)))))....)))))).))))).((((......(((.....)))......))))((((....))))((((.(((((..(((.......)))..)))))..))))....((((.....))))...))))))',
  '.((((((......)))))).............................(......)............((........)).......................................................................(((((.((((...)))).)))))..((((((..(((((((((....)))))))))....))))))...((((((......)))).))((((((((((((...))))))).)))))...................................................(((.....((((..((.(......).))..)))).....))).............................................................((((.(((((..(((.......)))..)))))..))))....((((.....)))).........',
  '....((((((....))))))(((((((.....(((.((.((..(((((((((((..........(((((....)))))(((((((.(((((..(((..(((..........))))))...))))))))))))(((((.....))))).))))))))))).)).)))))...(((((.........)))))((((...))))......))))))).((((.....))))............',
  '.....((((......)))).(((((((.........((.((..(((((((((((..........(((((....)))))(((.(((((......(((..(((..........)))))).........)))))..)))............))))))))))).)).)).......((((.........)))).((((...))))......)))))))..........................',
  '((((((.......................))))))....(((((((((((((((.......(((.((((...)))))))........((.(((.......))).))(((((.......)))))......(((((..(((.(((......((((..((((........))))...)))).......(((.((((((...)))))).)))..((((.......)))).))).))))))))....(((((((((...)))))))))...........(((...)))..))))))))))....)))))....',
  '((((((.......................))))))....((((.((((((((((.......(((.((((...)))))))........((.(((.......))).))(((((.......)))))......(((((.....................((((........))))...............((.(((((.....))))).))...((((.......))))........)))))....(((((((((...)))))))))......................)))))))))).....))))....',
  '((((((....)))))).((((((....))))))....((((((((((((.((....((((((((((((((((((...........((..((((((((((......((((((...))))))....))))))))))..)).....(((((.((((((((.(((((.....))))))))))))))))))))))...)))))))))))))))).)))))..............))))..))).....((((.((((...((..(((...(((((.(((((.(((............))).))))))))))...)))..))...((((..((((((((((...)))))))))).)))).)))).))))',
  '(((((......))))).((((((....))))))....(((((((((((..((....(((((((((((((((((((..........((..((((((((((......((((((...))))))....))))))))))..))......((((.((((((((.(((((.....))))))))))))))))))))))...))))))))))))))))..)))..............))))))..))......(((.(((....((..(((...(((((.((((....................))))..)))))...)))..))...((((..((((((((((...)))))))))).))))..))).))).',
  '....(((((((((((((.(((((((..........)))).......))).))))....(((((.....)))))....)))))).)))((((((..((((..(((((((((((((.(((...(((((((.....(((((.......)))))..))))))).((((((((...((...))...))))))))))).)))))).((((.((.(((((((((((....(((((((((...((((.(((((..(((((.(((((...((((((.((((((.....(((((((((((((((((((....)))))))))))))))))))......)))))).))))))....))))).))))).)))))))))....)))))).)))..))))))))))).))))))..)))))))..)))).))))))..',
  '...(((((.(((.(((.((.......)).))).)))...((.((.(((.((((((.......))))))..))).)).))(((((((......))).))))((((..(((.((((.((((..(((((.....)))))..)))).)).)).))).))))...)))))((((...))))......',
  '.............................................(((.((((((.......))))))..)))......(((((((......))).))))...............((((..(((((.....)))))..))))...((((.......))))......................',
  '....((((...(((...............)))...)))).........................((((...........))))((((.(((((.(((((((...(((((.(((.((((((....))))))..))).)))))...))))))).))))).))))((((((((((....(((((((((((((((..((((....))))))))))).))))))))...))))))))))........',
  '....((((...(((...............)))...))))...........................................(((((.(((((.(((((((...(((((.(((.((((((....))))))..))).)))))...))))))).))))).))))).((((((((....(((((((((((((((..(((......)))))))))).))))))))...))))))))..........',
  '......(((((((...)))))))....((.(((((...)))))))....',
  '.((((.(((.((((.(((((.(((((...)))))(((((.(((((((((....((((((((....)))))..)))....((((.(((((((((((........))))))))))).))))(((....((..(((((..(((((...........(((((..(((((((.(((((((((((((((...)))))..)))).((((.((((((((...)))))))).))))..)))))))))))))..)))))....(((((((.((((......((((.((.(((.((((.....)))).)))))))))))))..)))).)))))))))))))..)))))((((((((((((((((.(((((((((((...(((((.(((((......))))).)))))...)))).))))))).))))))))))).))))).((((((....(((((..(((((.........))))))))))....)))))))))))).(((((.((...)).)))))....((((...))))))).))))).................((((((((((...))))....((((((.....((.......)).....)))))).......))))))....)))))))))..))).))))......((((.(((.(((((((((((...((((((((((....(((((((....)))))........((((........))))..)))))))))).)).)))))))))((((..((((.(((.(((....((((((.....))))))...))).)))))))...))))((((..........)))).....)).))).)))).........',
  '.((((.(((.((((.(((((.(((((...)))))(((((.(((((((((....((((((((....)))))..)))......((.(((((((((((........))))))))))).)).........((..(((((..(((((.........(.(((((..(((((((.(((((((((((((((...)))))..)))).((((.((((((((...)))))))).))))..)))))))))))))..))))))...(((((((.((((......((((.((.(((.((((.....)))).)))))))))))))..)))).)))))))))))))..))...((((((((((((((((.(((((((((((...(((((.(((((......))))).)))))...))))).)))))).))))))))))).))))).((((((....(((((..(((((.........))))))))))....)))))))))))).(((((.........)))))....((((...))))))).))))).................((((((((((...))))....((((((.....................)))))).......))))))....)))))))))..))).))))......((((.(((.(((((((((((...((((((((((....(((((((....)))))........((((........))))..)))))))))).)).)))))))))((((..((((.(((.(((....((((((.....))))))...))).)))))))...))))(((((.......).)))).....)).))).)))).........',
  '..............((((((.....(((((((((.(((....)))..)))....((((((.((((.(((.((((...)))))))...))))..)))))).......(((((...(((((((((.((......(((((.....(((.............((((.(((((((.((.(((....))))).)))))..)).))))..))))))))......)).)))))))))..............)))))))))))........))))))((((...........)))).(((.....)))...',
  '..............((((((...........(((.(((....)))..)))....((((((.((((.(((.((((...)))))))...))))..))))))....((.(((((...(((((((((.((.........((...((((((................((.(((((.((.(((....))))).))))))).........)))))).)).....)).)))))))))..............))))).))...........))))))((((...........)))).(((.....)))...',
  '....(((((((..((((.(((((..............))))).)).))....))))))).....(((((((((((....))))..((((.((((((......))))))((((((((..(((..(((...........)))...)))......(((((((.........)))))))))))))))...((.(((((((..(((((((....((.((((.(((((....))))).)))).)).....(((.((.(((.......))).)).)))......(((...(((.((((....)))).)))..)))(((((..((.....)).))))))))..))))..))))))).))))))(((((((...)))))))...(((((...((......((((.........))))......))...)))))................((((((((((((...)))))))))))))))))))',
  '....(((((((..((((.(((((..............))))).)).))....))))))).....(((((((((((....))))..(((..((((((......))))))((((((((..((...(((...........)))....))......(((((((.........)))))))))))))))...((.(((((((..(((((((.....(.((((.(((((....))))).)))).)......(((.((.(((.......))).)).)))....((((........((((....)))).....)))).(.((..((.....)).)).).)))..))))..))))))).)).)))(((((((...)))))))........................((((..((.....(((((....)))))...)).)))).......((((((((((((...)))))))))))))))))))',
];

describe('untangle function', () => {
  test('smoke test', () => {
    expect(randomStructures.length).toBeGreaterThanOrEqual(75);

    shuffled(randomStructures).slice(0, 20).forEach(dotBracket => {
      let [seq, basePairs] = StructureMock.fromDotBracket(dotBracket);

      // runs without throwing
      untangle(seq, basePairs, {
        spacing: 20 * Math.random(),
        basePairSpacing: 20 * Math.random(),
      });

      // arranges the bases into a valid layout
      expect((new Layout(seq)).isValid()).toBe(true);
    });
  });

  test('an empty structure', () => {
    let [seq, basePairs] = [[], []];

    expect(() => untangle(seq, basePairs, { spacing: 1, basePairSpacing: 1 })).not.toThrow();
  });

  test('a structure with only one base', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.');

    expect(seq.length).toBe(1);
    expect(basePairs.length).toBe(0);

    untangle(seq, basePairs, { spacing: 2, basePairSpacing: 1 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('a structure with no base-pairs', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('......................................');

    expect(seq.length).toBe(38);
    expect(basePairs.length).toBe(0);

    untangle(seq, basePairs, { spacing: 2, basePairSpacing: 1.5 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('a hairpin', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('((((((.....))))))');

    expect(seq.length).toBe(17);
    expect(basePairs.length).toBe(6);

    untangle(seq, basePairs, { spacing: 3, basePairSpacing: 2.5 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('a one base-pair stem', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('..(....)....');

    expect(seq.length).toBe(12);
    expect(basePairs.length).toBe(1);

    untangle(seq, basePairs, { spacing: 1.5, basePairSpacing: 1.25 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('a structure that is just one base-pair', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('()');

    expect(seq.length).toBe(2);
    expect(basePairs.length).toBe(1);

    expect(basePairs[0][0]).toBe(seq[0]);
    expect(basePairs[0][1]).toBe(seq[1]);

    untangle(seq, basePairs, { spacing: 8, basePairSpacing: 10 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('hairpins with small loop sizes', () => {
    let structures = [
      '(((())))',
      '((((.))))',
      '((((..))))',
      '((((...))))',
    ];

    structures.forEach(dotBracket => {
      let [seq, basePairs] = StructureMock.fromDotBracket(dotBracket);

      untangle(seq, basePairs, {
        spacing: 20 * Math.random(),
        basePairSpacing: 20 * Math.random(),
      });

      expect((new Layout(seq)).isValid()).toBe(true);
    });
  });

  test('linkers with small numbers of unpaired bases', () => {
    let structures = [
      '((((....))))((((....))))',
      '((((....)))).((((....))))',
      '((((....))))..((((....))))',
      '((((....))))...((((....))))',
    ];

    structures.forEach(dotBracket => {
      let [seq, basePairs] = StructureMock.fromDotBracket(dotBracket);

      untangle(seq, basePairs, {
        spacing: 20 * Math.random(),
        basePairSpacing: 20 * Math.random(),
      });

      expect((new Layout(seq)).isValid()).toBe(true);
    });
  });

  test('a pseudoknot', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.................................');

    expect(seq.length).toBe(33);
    expect(basePairs.length).toBe(0);

    // stem 1
    basePairs.push([seq[2], seq[15]]);
    basePairs.push([seq[3], seq[14]]);
    basePairs.push([seq[4], seq[13]]);

    // stem 2
    basePairs.push([seq[6], seq[29]]);
    basePairs.push([seq[7], seq[28]]);
    basePairs.push([seq[8], seq[27]]);
    basePairs.push([seq[9], seq[26]]);

    untangle(seq, basePairs, { spacing: 2.5, basePairSpacing: 1.4 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('a structure with unsorted base-pairs', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    // make unsorted
    basePairs = shuffled(basePairs);

    untangle(seq, basePairs, { spacing: 2, basePairSpacing: 1 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('spacing of zero', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 0, basePairSpacing: 1 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('very small spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 1e-6, basePairSpacing: 1 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('negative spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: -1, basePairSpacing: 1 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('very small negative spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: -1e-6, basePairSpacing: 1 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('base-pair spacing of zero', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 1, basePairSpacing: 0 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('very small base-pair spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 1, basePairSpacing: 1e-6 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('negative base-pair spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 1, basePairSpacing: -1 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('very small negative base-pair spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 1, basePairSpacing: -1e-6 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('positive hairpin loop spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 2, basePairSpacing: 1, hairpinLoopSpacing: 3 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('hairpin loop spacing of zero', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 2, basePairSpacing: 1, hairpinLoopSpacing: 0 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('negative hairpin loop spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 2, basePairSpacing: 1, hairpinLoopSpacing: -2.5 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  test('unspecified hairpin loop spacing', () => {
    let [seq, basePairs] = StructureMock.fromDotBracket('.....((((..(((.((((........)))).))).)))).((.........))...');

    untangle(seq, basePairs, { spacing: 2, basePairSpacing: 1 });

    expect((new Layout(seq)).isValid()).toBe(true);
  });

  /**
   * Creates some sample layouts using the `untangle()` function
   * and writes them to a specified directory
   * as CSV files that can be opened in a program like Excel
   * and viewed as scatter plots with the points connected by lines.
   */
  /*test('viewing some sample structures', () => {
    let directoryPathToWriteSampleLayoutsTo = 'src/sample-layouts/';

    let numSampleStructures = 20;

    let sampleStructures = Array.from({ length: numSampleStructures }).map(() => {
      let i = Math.floor(Math.random() * randomStructures.length);
      return randomStructures[i];
    });

    sampleStructures.forEach((dotBracket, i) => {
      let [seq, basePairs] = StructureMock.fromDotBracket(dotBracket);

      seq.forEach(b => b.setCenterPoint({ x: 100 * Math.random() - 50, y: 100 * Math.random() - 50 }))

      // test handling of unsorted base-pairs
      basePairs = shuffled(basePairs);

      untangle(seq, basePairs, { spacing: 5, basePairSpacing: 5, hairpinLoopSpacing: 2.5 });

      let layout = '';

      seq.forEach(b => {
        let { x, y } = { ...b.getCenterPoint() };
        layout += `${x},${y}\n`;
      });

      let layoutFilePath = directoryPathToWriteSampleLayoutsTo + `sample-layout-${i + 1}.csv`;

      fs.writeFileSync(layoutFilePath, layout);
    });
  });*/
});
